# Kit 谷歌浏览器扩展改造任务清单

## 项目概述

将现有的 Kit 多功能工具箱应用改造为谷歌浏览器扩展，保持现有功能的同时适配浏览器扩展环境。

### 当前项目技术栈

- React 18 + TypeScript 5
- Vite 6 构建工具
- TailwindCSS 4 样式框架
- Tauri 2 桌面端框架
- @tanstack/react-router 路由
- @tanstack/react-query 状态管理
- Radix UI + shadcn/ui 组件库

### 现有功能模块

项目包含 80+ 实用工具，涵盖：

- 文本处理（字数统计、大小写转换、正则测试等）
- 颜色/设计（取色器、渐变生成、阴影制作等）
- 图片/音视频（压缩、格式转换、裁剪等）
- 加解密/哈希（MD5、SHA-256、密码生成等）
- 日期/时间（时间戳转换、时区计算等）
- 数据格式转换（JSON、YAML、Base64等）
- 网络工具（HTTP状态码、DNS查询等）
- 随机/生成器（UUID、二维码、条形码等）

## 🎯 改造目标

1. **保持现有功能**：所有工具功能保持不变
2. **浏览器扩展化**：适配 Chrome Extension Manifest V3
3. **优化用户体验**：弹窗界面优化，快速访问常用工具
4. **本地数据安全**：使用 Chrome Storage API 管理用户数据
5. **无需网络**：保持离线工作能力

## 📋 详细任务清单

### 阶段一：基础架构改造

#### ✅ 1. 项目分析

- [x] 分析现有项目结构和技术栈
- [x] 了解组件架构和路由系统
- [x] 识别需要移除的 Tauri 相关代码

#### ✅ 2. 扩展配置文件

- [x] 创建 `manifest.json` (Manifest V3)
  - [x] 配置基本信息（名称、版本、描述）
  - [x] 设置权限（storage、activeTab、contextMenus、clipboardWrite、notifications）
  - [x] 定义 action、background、content_scripts
  - [x] 配置图标和资源文件
  - [x] 设置内容安全策略（CSP）
- [x] 创建扩展图标集合（16x16, 48x48, 128x128）

#### ✅ 3. 构建系统改造

- [x] 创建 `vite.extension.config.ts`
  - [x] 配置多入口点（background、content）
  - [x] 调整输出目录结构 (`dist-extension`)
  - [x] 修改 chunk 分割策略
  - [x] 移除 Tauri 相关配置
  - [x] 优化扩展包大小和性能
- [x] 创建扩展专用构建脚本 (`scripts/build-extension.mjs`)
- [x] 配置自动化打包流程

#### ✅ 4. 内容安全策略

- [x] 调整 CSP 策略符合扩展要求
- [x] 移除内联脚本和样式
- [x] 配置安全的资源加载策略
- [x] 支持 WASM 和 Web Workers

### 阶段二：核心功能改造

#### ✅ 5. 扩展UI模式设计（新标签页模式）

- [x] 配置扩展为新标签页模式（不使用弹窗）
- [x] 实现完整工具界面在新标签页中打开
- [x] 保留完整的搜索和分类导航功能
- [x] 保持响应式设计和移动端适配
- [x] 收藏和最近使用功能正常工作

#### ✅ 6. 背景脚本

- [x] 创建 Service Worker (`background.js`)
- [x] 实现扩展生命周期管理
- [x] 配置右键菜单快捷功能
  - [x] 文本工具（字数统计、大小写转换）
  - [x] 图片工具菜单
  - [x] 取色器快捷访问
- [x] 添加扩展图标点击处理（新标签页打开）
- [x] 实现消息传递机制

#### ✅ 7. 存储系统改造

- [x] 保留 IndexedDB 支持（用于大数据）
- [x] 实现 Chrome Storage API 适配层 (`src/extension/storage.ts`)
- [x] 迁移用户偏好设置存储（收藏、最近使用）
- [x] 实现本地/同步存储管理器
- [x] 添加存储变化监听机制

#### ✅ 8. Tauri 代码清理

- [x] 保留 `src-tauri` 目录（用于桌面版本）
- [x] 删除扩展构建中的 Tauri 相关依赖
- [x] 移除 Tauri API 调用，替换为扩展API
  - [x] `isTauri()` → `isExtension()`
  - [x] `@tauri-apps/plugin-opener` → `chrome.tabs.create()`
- [x] 清理构建脚本中的 Tauri 命令

### 阶段三：功能优化

#### ✅ 9. 工具功能适配

- [x] 检查所有工具在扩展环境下的兼容性
- [x] 适配文件上传/下载功能
- [x] 优化大文件处理性能
- [x] 确保 Web Workers 正常工作
- [x] 修复 `isExtension` 函数导入问题

#### ✅ 10. 权限管理

- [x] 配置最小化权限集合
  - [x] storage（数据存储）
  - [x] activeTab（当前标签页访问）
  - [x] contextMenus（右键菜单）
  - [x] clipboardWrite（剪贴板写入）
  - [x] notifications（通知）
- [x] 添加权限说明和用户指导

#### ✅ 11. 内容脚本

- [x] 创建内容脚本 (`src/extension/content.ts`)
- [x] 实现页面数据提取工具
  - [x] 页面文本提取
  - [x] 选中文本获取
  - [x] 图片链接提取
  - [x] 文本高亮功能
- [x] 添加键盘快捷键支持（Ctrl+K）
- [x] 实现与背景脚本的消息传递

### 阶段四：优化和发布

#### ✅ 12. 性能优化

- [x] 压缩扩展包大小（0.05MB）
- [x] 优化启动速度（移除不必要的popup构建）
- [x] 实现代码分割和懒加载
- [x] 减少内存使用
- [x] 启用生产环境优化（terser压缩）

#### ✅ 13. 用户体验

- [x] 添加键盘快捷键支持（Ctrl+K）
- [x] 实现主题切换功能（默认亮色主题）
- [x] 新标签页模式提供完整体验
- [x] 添加设置为主页功能
- [x] 右键菜单快速访问

#### ✅ 14. 测试和调试

- [x] 本地扩展安装测试
- [x] 功能完整性测试
- [x] 修复样式加载问题
- [x] 修复 `isExtension` 函数问题
- [x] 验证所有必要文件存在

#### 🔄 15. 发布准备

- [ ] 创建应用商店素材
- [ ] 编写扩展描述和功能说明
- [ ] 准备隐私政策文档
- [ ] 配置自动更新机制

## 🚀 实施步骤

### ✅ 第一步：创建基础扩展结构

1. ✅ 创建 `manifest.json`
2. ✅ 配置新标签页模式（替代弹窗）
3. ✅ 配置构建系统

### ✅ 第二步：核心功能迁移

1. ✅ 移除 Tauri 依赖
2. ✅ 适配存储 API
3. ✅ 确保工具功能正常

### ✅ 第三步：界面优化

1. ✅ 实现新标签页完整体验
2. ✅ 实现快速访问功能（右键菜单）
3. ✅ 保持搜索和分类功能

### ✅ 第四步：测试和发布

1. ✅ 全面功能测试
2. ✅ 性能优化
3. 🔄 准备发布材料

## 📁 实际文件结构

```
dist-extension/
├── manifest.json           # 扩展配置文件
├── background.js          # 背景脚本 (1.95KB)
├── content.js             # 内容脚本 (1.53KB)
├── icons/                 # 扩展图标
│   ├── icon16.png
│   ├── icon48.png
│   └── icon128.png
├── assets/                # 构建后的静态资源
├── workers/               # Web Workers
├── logo.png              # 应用Logo
├── tauri.svg             # SVG图标
├── vite.svg              # Vite图标
└── ads.txt               # 广告配置（可选）
```

**注意：使用新标签页模式，无需 popup.html 文件**

## 🎯 成功标准

- ✅ 所有现有工具功能正常运行
- ✅ 扩展能在 Chrome 浏览器中正常安装和使用
- ✅ 新标签页模式提供完整用户体验
- ✅ 数据存储和同步功能正常
- ✅ 扩展包大小控制在合理范围内（0.05MB < 10MB）
- 🔄 通过 Chrome Web Store 审核要求（待发布）

## 🔥 新增特性

### 用户体验升级：

- ✅ **新标签页模式**：点击扩展图标直接在新标签页打开完整工具箱
- ✅ **右键菜单集成**：在网页上右键可快速访问常用工具
- ✅ **键盘快捷键**：Ctrl+K 快速唤起工具箱
- ✅ **默认亮色主题**：提供更一致的视觉体验
- ✅ **设置为主页**：一键将工具箱设为浏览器主页

### 技术改进：

- ✅ **Chrome Storage API**：完整的数据存储解决方案
- ✅ **内容脚本功能**：页面数据提取、文本高亮等
- ✅ **环境自适应**：自动检测扩展/Web环境并调整功能
- ✅ **性能优化**：精简构建，快速启动

## 📝 注意事项

1. **Manifest V3 要求**：必须使用最新的扩展API规范
2. **CSP限制**：不能使用内联脚本，需要外部化所有JS代码
3. **权限最小化**：只请求必要的权限，避免过度权限申请
4. **性能考虑**：扩展启动速度要快，内存使用要少
5. **用户隐私**：所有数据本地处理，不上传到服务器

---

## 🎉 项目状态

**项目进度**：98% 完成  
**当前状态**：✅ 核心功能完成，可正常使用  
**剩余工作**：发布准备（应用商店素材等）  
**最后更新**：2025年1月9日

## 📦 快速开始

### 构建扩展：

```bash
npm run build:extension
```

### 安装到Chrome：

1. 打开 `chrome://extensions/`
2. 启用"开发者模式"
3. 点击"加载已解压的扩展程序"
4. 选择 `dist-extension` 文件夹

### 使用扩展：

- 点击扩展图标 → 在新标签页打开Kit工具箱
- 右键菜单 → 快速访问常用工具
- Ctrl+K → 键盘快捷键（在网页中）

**🎊 恭喜！Kit Chrome扩展改造完成！**
